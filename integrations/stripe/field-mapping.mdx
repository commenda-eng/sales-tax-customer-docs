---
title: Stripe field mapping reference
description: Complete mapping of Stripe data fields to RootFi and Sales Tax models with transformation logic
---

This document provides a comprehensive reference for how Stripe data fields are mapped through RootFi to the final Sales Tax models.

## Data flow overview

```
Stripe Raw Data → RootFi Unified API → Sales Tax API Model
                         ↓
              (raw_data also available)
```

RootFi normalizes Stripe data into a unified data model. Sales Tax API consumes both:
- **RootFi Unified API fields** - Normalized, standardized fields
- **Stripe RawData** - Original Stripe data accessible via `raw_data` field for fields not normalized by RootFi

### Fields using Stripe RawData

The following Sales Tax fields are derived from **Stripe RawData** (via `raw_data` field from RootFi):

| Entity | Field | RawData Path | Notes |
|--------|-------|--------------|-------|
| Customer | Shipping Address | `raw_data.shipping.address` | Falls back to `raw_data` if no shipping |
| Transaction | Ship To Address | `raw_data.shipping.address` | Address parsing uses raw Stripe data |

All other fields use RootFi's normalized/unified API fields.

---

## Section 1: Stripe → RootFi mapping reference

This section documents how Stripe fields are stored in RootFi's unified data models.

### Customer (PAYMENT_CUSTOMERS)

| RootFi Field | Stripe Field | Parser/Transformation |
|--------------|--------------|----------------------|
| `platform_id` | `id` | Direct mapping |
| `platform_unique_id` | `id` | Direct mapping |
| `created_at` | `created` | `STRIPE_DATE_PARSER` (Unix seconds → ISO date) |
| `updated_at` | - | Not available from Stripe |
| `name` | `name` | Direct mapping |
| `tax_number` | `tax_ids.data[0].value` | First tax ID value |
| `currency_id` | `currency` | `STRIPE_CURRENCY_PARSER` (lowercase → uppercase) |
| `addresses` | `address`, `shipping.address` | `STRIPE_CONTACT_ADDRESS_PARSER` |
| `phone_numbers` | `phone` | `STRIPE_CONTACT_PHONE_NUMBERS_PARSER` |
| `external_links` | `email` | `STRIPE_CONTACT_EXTERNAL_LINKS_PARSER` |

#### Address parsing logic (STRIPE_CONTACT_ADDRESS_PARSER)

```pseudo
function STRIPE_CONTACT_ADDRESS_PARSER(customer):
    addresses = []
    
    # Billing address from customer.address
    if customer.address exists:
        billing = {
            type: "BILLING",
            line1: customer.address.line1,
            line2: customer.address.line2,
            city: customer.address.city,
            state: customer.address.state,
            postal_code: customer.address.postal_code,
            country: customer.address.country
        }
        addresses.push(billing)
    
    # Shipping address from customer.shipping.address
    if customer.shipping?.address exists:
        shipping = {
            type: "SHIPPING",
            line1: customer.shipping.address.line1,
            line2: customer.shipping.address.line2,
            city: customer.shipping.address.city,
            state: customer.shipping.address.state,
            postal_code: customer.shipping.address.postal_code,
            country: customer.shipping.address.country
        }
        addresses.push(shipping)
    
    return addresses
```

### Product (PAYMENT_PRODUCTS)

| RootFi Field | Stripe Field | Parser/Transformation |
|--------------|--------------|----------------------|
| `platform_id` | `id` | Direct mapping |
| `platform_unique_id` | `id` | Direct mapping |
| `created_at` | `created` | `STRIPE_DATE_PARSER` |
| `description` | `description` | Direct mapping |
| `name` | `name` | Direct mapping |
| `status` | `active` | `STRIPE_PRODUCT_STATUS_PARSER` (true→ACTIVE, false→ARCHIVED) |
| `updated_at` | `updated` | `STRIPE_DATE_PARSER` |

### Invoice (PAYMENT_INVOICES)

| RootFi Field | Stripe Field | Parser/Transformation |
|--------------|--------------|----------------------|
| `platform_id` | `id` | Direct mapping |
| `platform_unique_id` | `id` | Direct mapping |
| `document_number` | `number` | Direct mapping |
| `contact_id` | `customer` | Stripe customer ID |
| `posted_date` | `effective_at` | `STRIPE_DATE_PARSER` |
| `due_date` | `due_date` | `STRIPE_DATE_PARSER` |
| `currency_id` | `currency` | `STRIPE_CURRENCY_PARSER` |
| `status` | `status` | `ARTIFACT_STATUS_ENUM` mapper |
| `sub_total` | `subtotal` | `STRIPE_AMOUNT_PARSER` (cents → dollars) |
| `tax_amount` | `total_tax_amounts` | `STRIPE_TOTAL_TAX_AMOUNT_PARSER` |
| `total_discount` | `total_discount_amounts` | `STRIPE_TOTAL_DISCOUNT_AMOUNT_PARSER` |
| `total_amount` | `total` | `STRIPE_AMOUNT_PARSER` |
| `amount_due` | `amount_due` | `STRIPE_AMOUNT_PARSER` |
| `memo` | `description` | Direct mapping |
| `created_at` | `created` | `STRIPE_DATE_PARSER` |
| `line_items` | `lines.data` | Nested mapping to PAYMENT_LINE_ITEMS |
| `addresses` | `customer_address`, `customer_shipping.address` | `STRIPE_INVOICE_ADDRESS_PARSER` |
| `shipping_amount` | `shipping_cost.amount_total` | `STRIPE_AMOUNT_PARSER` |

#### Invoice address parsing logic (STRIPE_INVOICE_ADDRESS_PARSER)

```pseudo
function STRIPE_INVOICE_ADDRESS_PARSER(invoice):
    addresses = []
    
    # Billing address from invoice.customer_address
    if invoice.customer_address exists:
        billing = {
            type: "BILLING",
            line1: invoice.customer_address.line1,
            line2: invoice.customer_address.line2,
            city: invoice.customer_address.city,
            state: invoice.customer_address.state,
            postal_code: invoice.customer_address.postal_code,
            country: invoice.customer_address.country
        }
        addresses.push(billing)
    
    # Shipping address from invoice.customer_shipping.address
    if invoice.customer_shipping?.address exists:
        shipping = {
            type: "SHIPPING",
            line1: invoice.customer_shipping.address.line1,
            line2: invoice.customer_shipping.address.line2,
            city: invoice.customer_shipping.address.city,
            state: invoice.customer_shipping.address.state,
            postal_code: invoice.customer_shipping.address.postal_code,
            country: invoice.customer_shipping.address.country
        }
        addresses.push(shipping)
    
    return addresses
```

### Line Item (PAYMENT_LINE_ITEMS)

| RootFi Field | Stripe Field | Parser/Transformation |
|--------------|--------------|----------------------|
| `platform_id` | `id` | Direct mapping |
| `platform_unique_id` | `id` | Direct mapping |
| `line_item_type` | `$data_model` | Parent data model type |
| `line_item_type_id` | `$parent.id` | Parent record ID |
| `description` | `description` | Direct mapping |
| `item_id` | `price.product` | `STRIPE_ITEM_ID_PARSER` |
| `total_discount` | `discount_amounts` | `STRIPE_TOTAL_DISCOUNT_AMOUNT_PARSER` |
| `tax_amount` | `tax_amounts` | `STRIPE_TOTAL_TAX_AMOUNT_PARSER` |
| `quantity` | `quantity` | Direct mapping |
| `unit_amount` | `unit_amount_excluding_tax` | `STRIPE_LINE_ITEM_UNIT_AMOUNT_PARSER` |
| `total_amount` | `amount` | `STRIPE_AMOUNT_PARSER` |
| `tax_id` | `tax_rates[0].id` | First tax rate ID |
| `sub_total` | `amount_excluding_tax` | `STRIPE_AMOUNT_PARSER` |

### Tax Rate (PAYMENT_TAX_RATES)

| RootFi Field | Stripe Field | Parser/Transformation |
|--------------|--------------|----------------------|
| `platform_id` | `id` | Direct mapping |
| `platform_unique_id` | `id` | Direct mapping |
| `created_at` | `created` | `STRIPE_DATE_PARSER` |
| `updated_at` | `updated_at` | `STRIPE_DATE_PARSER` |
| `name` | `display_name` | Direct mapping |
| `description` | `description` | Direct mapping |
| `rate` | `percentage` | `STRIPE_RATE_PARSER` (percentage → decimal, e.g., 8.25 → 0.0825) |

### Credit Note (PAYMENT_CREDIT_NOTES)

| RootFi Field | Stripe Field | Parser/Transformation |
|--------------|--------------|----------------------|
| `platform_id` | `id` | Direct mapping |
| `platform_unique_id` | `id` | Direct mapping |
| `contact_id` | `customer` | Stripe customer ID |
| `currency_id` | `currency` | `STRIPE_CURRENCY_PARSER` |
| `document_number` | `number` | Direct mapping |
| `invoice_ids` | `invoice` | Single invoice ID as array |
| `line_items` | `lines.data` | Nested mapping |
| `memo` | `memo` | Direct mapping |
| `posted_date` | `effective_at` | `STRIPE_DATE_PARSER` |
| `status` | `status` | `ARTIFACT_STATUS_ENUM` mapper |
| `tax_amount` | `total_tax_amounts` | `STRIPE_TOTAL_TAX_AMOUNT_PARSER` |
| `total_amount` | `total` | `STRIPE_AMOUNT_PARSER` |
| `total_discount` | `total_discount_amounts` | `STRIPE_TOTAL_DISCOUNT_AMOUNT_PARSER` |
| `created_at` | `created` | `STRIPE_DATE_PARSER` |
| `shipping_amount` | `shipping_cost.amount_total` | `STRIPE_AMOUNT_PARSER` |

### Refund (PAYMENT_REFUNDS)

| RootFi Field | Stripe Field | Parser/Transformation |
|--------------|--------------|----------------------|
| `platform_id` | `id` | Direct mapping |
| `platform_unique_id` | `id` | Direct mapping |
| `created_at` | `created` | `STRIPE_DATE_PARSER` |
| `amount` | `amount` | Direct (in cents) |
| `currency_id` | `currency` | `STRIPE_CURRENCY_PARSER` |
| `payment_id` | `payment_intent` | Stripe payment intent ID |
| `description` | `reason` | Refund reason |
| `status` | `status` | `PAYMENTS_REFUND_STATUS_ENUM` mapper |

### Subscription (PAYMENT_SUBSCRIPTIONS)

| RootFi Field | Stripe Field | Parser/Transformation |
|--------------|--------------|----------------------|
| `platform_id` | `id` | Direct mapping |
| `platform_unique_id` | `id` | Direct mapping |
| `created_at` | `created` | `STRIPE_DATE_PARSER` |
| `contact_id` | `customer` | Stripe customer ID |
| `currency_id` | `currency` | `STRIPE_CURRENCY_PARSER` |
| `current_end` | `current_period_end` | `STRIPE_DATE_PARSER` |
| `current_start` | `current_period_start` | `STRIPE_DATE_PARSER` |
| `description` | `description` | Direct mapping |
| `line_items` | `items.data` | `STRIPE_SUBSCRIPTION_ITEMS_PARSER` |
| `payment_method` | `default_payment_method` | Direct mapping |
| `status` | `status` | Direct mapping |

### Parser functions reference

#### STRIPE_AMOUNT_PARSER
Converts Stripe amounts from smallest currency unit (cents) to standard unit (dollars).

```pseudo
function STRIPE_AMOUNT_PARSER(value, record, stack):
    if value is null:
        return null
    
    # Determine currency from record or parent
    if record.object == "invoice" or record.object == "credit_note":
        currency = record.currency
    else if record.object == "line_item":
        currency = stack[1].currency  # Parent's currency
    
    # Convert from smallest unit to standard unit
    return CurrencyHandler.fromLowerDenominator(value, currency)
    
    # Example: 1000 cents USD → 10.00 dollars
    # Example: 1000 JPY → 1000 (JPY has 0 decimal places)
```

#### STRIPE_DATE_PARSER
Converts Unix timestamps (seconds) to ISO date strings.

```pseudo
function STRIPE_DATE_PARSER(timestamp):
    if timestamp is null:
        return null
    # Stripe timestamps are in seconds (Unix epoch)
    return new Date(timestamp * 1000).toISOString()
```

#### STRIPE_CURRENCY_PARSER
Converts lowercase currency codes to uppercase ISO 4217.

```pseudo
function STRIPE_CURRENCY_PARSER(currency_code):
    if currency_code is null:
        return null
    return currency_code.toUpperCase()  # "usd" → "USD"
```

---

## Section 2: RootFi → Sales Tax mapping

This section documents how Sales Tax API consumes data from RootFi, specifying whether each field comes from the **RootFi Unified API** or **Stripe RawData**.

### Customer

| Sales Tax Field | Source | RootFi/Stripe Field | Notes |
|-----------------|--------|---------------------|-------|
| `ID` | Generated | - | UUID generated by Sales Tax |
| `Name` | RootFi Unified API | `name` | Direct mapping |
| `Email` | RootFi Unified API | `external_links` (type=EMAIL) | Extracted from external links array |
| `SourcePlatformID` | RootFi Unified API | `platform_id` | Stripe customer ID (e.g., `cus_xxx`) |
| `SourcePlatform` | Constant | - | Set to `STRIPE` |
| `CorporationId` | Context | - | From integration connection |
| `ShippingAddress` | RootFi Unified API | `addresses` (type=SHIPPING) | See address resolution below |

#### Customer shipping address resolution

For Stripe, addresses are extracted from **Stripe RawData** (not RootFi unified fields):

```pseudo
function resolveCustomerShippingAddress(customer):
    # For Stripe: Use raw_data.shipping.address or raw_data directly
    rawAddress = customer.addresses[0].raw_data.shipping.address 
                 ?? customer.addresses[0].raw_data
    
    return {
        address_line_1: rawAddress.line1,
        city: rawAddress.city,
        state: rawAddress.state,
        postal_code: rawAddress.postal_code,
        country: rawAddress.country
    }
```

<Info>
**Stripe-specific behavior:** Unlike other integrations that use RootFi's normalized address fields (`street`, `locality`, `city`, `state`, `country`, `pincode`), Stripe addresses are parsed directly from the `raw_data` field to preserve the original Stripe address structure.
</Info>

### Product

| Sales Tax Field | Source | RootFi/Stripe Field | Notes |
|-----------------|--------|---------------------|-------|
| `ID` | Generated | - | UUID generated by Sales Tax |
| `Name` | RootFi Unified API | `name` | Direct mapping |
| `TaxCode` | Hardcoded | - | Set to empty string `""` (not mapped from Stripe) |
| `Sku` | Hardcoded | - | Set to empty string `""` (not mapped from Stripe) |
| `Description` | RootFi Unified API | `description` | Direct mapping |
| `SourcePlatformID` | RootFi Unified API | `platform_id` | Stripe product ID (e.g., `prod_xxx`) |
| `SourcePlatform` | Constant | - | Set to `STRIPE` |
| `CorporationId` | Context | - | From integration connection |

<Note>
**SKU and TaxCode are not available from Stripe via RootFi.** The Stripe transformer explicitly sets these to empty strings. If you need SKU or tax codes for products, they must be manually configured in the Sales Tax system after sync.
</Note>

#### Tax code defaulting logic

```pseudo
function getTaxCode(line_item, product, corporation_config):
    # Priority order:
    # 1. Line item explicit tax code
    if line_item.taxability_code is not empty:
        return line_item.taxability_code
    
    # 2. Product's tax code (from RootFi)
    if product exists and product.tax_code is not empty:
        return product.tax_code
    
    # 3. Corporation default configuration
    if corporation_config.default_product_taxability_code exists:
        return corporation_config.default_product_taxability_code
    
    # 4. System default
    return "TPP"  # Tangible Personal Property
```

### Transaction (Invoice)

| Sales Tax Field | Source | RootFi/Stripe Field | Notes |
|-----------------|--------|---------------------|-------|
| `ID` | Generated | - | UUID generated by Sales Tax |
| `CorporationId` | Context | - | From integration connection |
| `TransactedAt` | RootFi Unified API | `posted_date` | ISO date string |
| `InvoiceCurrency` | RootFi Unified API | `currency_id` | ISO currency code (e.g., `USD`) |
| `Subtotal` | RootFi Unified API | `sub_total` | Already converted to dollars |
| `Discount` | RootFi Unified API | `total_discount` | Already converted to dollars |
| `ShippingAndHandling` | RootFi Unified API | `shipping_amount` | Already converted to dollars |
| `Total` | RootFi Unified API | `total_amount` | Already converted to dollars |
| `TaxCollected` | RootFi Unified API | `tax_amount` | Already converted to dollars |
| `TransactionType` | Derived | - | `SALE`, `RETURN`, or `REFUND` based on document type |
| `SourcePlatform` | Constant | - | Set to `STRIPE` |
| `SourcePlatformID` | RootFi Unified API | `platform_id` | Stripe invoice ID (e.g., `in_xxx`) |
| `InvoiceNumber` | RootFi Unified API | `document_number` | Direct mapping |
| `CustomerId` | Resolved | `contact_id` | Resolved by `source_platform_id` lookup |
| `ShippingAddress` | RootFi Unified API | `addresses` (type=SHIPPING) | See address resolution below |

#### Transaction shipping address resolution with fallback

For Stripe, addresses are extracted from **Stripe RawData**:

```pseudo
function resolveTransactionShippingAddress(transaction, customer):
    # Step 1: For Stripe - parse from raw_data.shipping.address
    if transaction.addresses exists:
        rawAddress = transaction.addresses[0].raw_data.shipping.address 
                     ?? transaction.addresses[0].raw_data
        
        return {
            address_line_1: rawAddress.line1,
            city: rawAddress.city,
            state: rawAddress.state,
            postal_code: rawAddress.postal_code,
            country: rawAddress.country
        }
    
    # Step 2: Fallback to customer's shipping address (also from raw_data)
    if customer exists and customer.shipping_address exists:
        return customer.shipping_address
    
    # Step 3: No shipping address available - calculation will fail
    return null  # Error: CALCULATION_MISSING_SHIP_TO_ADDRESS
```

<Warning>
**Address source for Stripe:** The address parsing logic specifically uses `raw_data.shipping.address` or `raw_data` for Stripe integration. This is different from other integrations that use RootFi's normalized address fields.
</Warning>

### Line Item

| Sales Tax Field | Source | RootFi/Stripe Field | Notes |
|-----------------|--------|---------------------|-------|
| `ID` | Generated | - | UUID generated by Sales Tax |
| `Amount` | RootFi Unified API | `total_amount` | Already converted to dollars |
| `Quantity` | RootFi Unified API | `quantity` | Direct mapping |
| `Discount` | RootFi Unified API | `total_discount` | Already converted to dollars |
| `TaxCollected` | RootFi Unified API | `tax_amount` | Already converted to dollars |
| `TaxCode` | Hardcoded or Resolved | - | Empty string `""` unless shipping item (`SRV_Shipping`) |
| `ProductSKU` | Hardcoded | - | Set to empty string `""` (not mapped from Stripe) |
| `ProductId` | Resolved | `item_id` | Resolved by `source_platform_id` lookup |
| `PricePerUnit` | RootFi Unified API | `unit_amount` | Already converted to dollars |

<Note>
**Product SKU and TaxCode:** For Stripe line items, `Product SKU` is always empty and `Product Taxability Code` is empty except for shipping line items which use `SRV_Shipping`.
</Note>

#### Product resolution for line items

```pseudo
function resolveLineItemProduct(line_item, corporation_id):
    # Get product ID from line item
    product_source_platform_id = line_item.item_id  # This is Stripe product ID (prod_xxx)
    
    if product_source_platform_id is empty:
        return {
            product_id: null,
            tax_code: "TPP"  # Default
        }
    
    # Look up product by source platform ID
    product = GetProductBySourcePlatformId(
        corporation_id,
        "STRIPE",
        product_source_platform_id
    )
    
    if product exists:
        return {
            product_id: product.ID,
            tax_code: product.tax_code ?? "TPP"
        }
    
    # Product not found in Sales Tax system
    return {
        product_id: null,
        tax_code: "TPP"
    }
```

### Customer resolution for transactions

```pseudo
function resolveCustomer(corporation_id, source_platform, source_platform_id):
    # Look up customer by source platform ID
    customer = GetCustomerBySourcePlatformId(
        corporation_id,
        source_platform,      # "STRIPE"
        source_platform_id    # e.g., "cus_xxx"
    )
    
    if customer exists and customer.corporation_id == corporation_id:
        return customer.ID
    
    return null
```

---

## Address field mapping detail

### Stripe address structure

```json
{
  "line1": "123 Main St",
  "line2": "Suite 100",
  "city": "San Francisco",
  "state": "CA",
  "postal_code": "94102",
  "country": "US"
}
```

### RootFi address structure (PAYMENT_ADDRESSES)

| RootFi Field | Stripe Field | Notes |
|--------------|--------------|-------|
| `type` | Derived | `BILLING` or `SHIPPING` based on source |
| `line1` | `line1` | Direct mapping |
| `line2` | `line2` | Direct mapping |
| `city` | `city` | Direct mapping |
| `state` | `state` | Direct mapping |
| `postal_code` | `postal_code` | Direct mapping |
| `country` | `country` | ISO 3166-1 alpha-2 |

### Sales Tax address structure

| Sales Tax Field | RootFi Field | Notes |
|-----------------|--------------|-------|
| `address_line_1` | `line1` | Required |
| `address_line_2` | `line2` | Optional |
| `address_line_3` | - | Not mapped from Stripe |
| `city` | `city` | Optional |
| `state` | `state` | Required for US |
| `postal_code` | `postal_code` | Required |
| `country` | `country` | Required, ISO country code |

---

## Enum mappings

### Invoice/Credit Note Status (ARTIFACT_STATUS_ENUM)

| Stripe Status | RootFi Status |
|---------------|---------------|
| `draft` | `DRAFT` |
| `open` | `OPEN` |
| `paid` | `PAID` |
| `uncollectible` | `UNCOLLECTIBLE` |
| `void` | `VOID` |
| `deleted` | `DELETED` |
| `issued` | `ISSUED` |

### Refund Status (PAYMENTS_REFUND_STATUS_ENUM)

| Stripe Status | RootFi Status |
|---------------|---------------|
| `pending` | `PENDING` |
| `succeeded` | `SUCCEEDED` |
| `failed` | `FAILED` |
| `canceled` | `CANCELED` |

---

## Currency handling

All Stripe monetary amounts are in the currency's smallest unit (e.g., cents for USD). RootFi converts these to standard units using `CurrencyHandler.fromLowerDenominator`:

| Currency | Decimal Places | Stripe Value | Converted Value |
|----------|---------------|--------------|-----------------|
| USD | 2 | 1000 | 10.00 |
| EUR | 2 | 1000 | 10.00 |
| JPY | 0 | 1000 | 1000 |
| BHD | 3 | 1000 | 1.000 |

By the time data reaches Sales Tax API, all amounts are already converted to standard units (dollars, not cents).
