---
title: Stripe field mapping reference
description: Complete mapping of Commenda Sales Tax fields and their data sources from RootFi
---

This document provides a comprehensive reference for all fields used by Commenda's Sales Tax engine and where each field originates from.

## Data flow overview

```
Stripe → RootFi (Unified API + Raw Data) → Commenda Sales Tax Engine
```

RootFi acts as Commenda's data integration vendor. RootFi provides:
- **Unified API fields** - Normalized, standardized fields across integrations
- **Raw Data** - Original Stripe data accessible via `raw_data` field

---

## Commenda Sales Tax field mappings

This section documents every field used by Commenda's Sales Tax engine and its source.

### Customer

| Sales Tax Field | Source | Source Field | Notes |
|-----------------|--------|--------------|-------|
| `ID` | Generated | - | UUID generated by Commenda |
| `Name` | RootFi Unified API | `name` | Direct mapping from `PaymentCustomerWebhookData.name` |
| `Email` | RootFi Unified API | `external_links` | Extracted from `external_links` array where `type === "EMAIL"` |
| `SourcePlatformID` | RootFi Unified API | `platform_id` | Stripe customer ID (e.g., `cus_xxx`) |
| `SourcePlatform` | Constant | - | Set to `STRIPE` |
| `CorporationId` | Context | - | From integration connection |
| `CreatedAt` | Generated | - | Timestamp when synced to Commenda |

#### Customer address fields

| Sales Tax Field | Source | Source Field | Notes |
|-----------------|--------|--------------|-------|
| `Shipping Address Line 1` | **Stripe RawData** | `raw_data.shipping.address.line1` or `raw_data.line1` | Falls back to `raw_data` if no shipping object |
| `Shipping Address Line 2` | **Stripe RawData** | `raw_data.shipping.address.line2` or `raw_data.line2` | Falls back to `raw_data` if no shipping object |
| `Shipping City` | **Stripe RawData** | `raw_data.shipping.address.city` or `raw_data.city` | Falls back to `raw_data` if no shipping object |
| `Shipping State` | **Stripe RawData** | `raw_data.shipping.address.state` or `raw_data.state` | Falls back to `raw_data` if no shipping object |
| `Shipping Postal Code` | **Stripe RawData** | `raw_data.shipping.address.postal_code` or `raw_data.postal_code` | Falls back to `raw_data` if no shipping object |
| `Shipping Country` | **Stripe RawData** | `raw_data.shipping.address.country` or `raw_data.country` | Falls back to `raw_data` if no shipping object |
| `Billing Address Line 1` | Not Mapped | - | Set to empty string `""` |
| `Billing City` | Not Mapped | - | Set to empty string `""` |
| `Billing State` | Not Mapped | - | Set to empty string `""` |
| `Billing Postal Code` | Not Mapped | - | Set to empty string `""` |
| `Billing Country` | Not Mapped | - | Set to empty string `""` |

#### Customer phone field

| Sales Tax Field | Source | Source Field | Notes |
|-----------------|--------|--------------|-------|
| `Phone` | RootFi Unified API | `phone_numbers` | Extracted by priority: `MOBILE` → `WORK` → `HOME` → first available |

<Info>
**Address parsing for Stripe:** The address parser in `sync.address_parser.ts` specifically uses `raw_data.shipping.address` or falls back to `raw_data` directly for Stripe integration. This bypasses RootFi's normalized address fields (`street`, `locality`, `city`, `state`, `country`, `pincode`).
</Info>

---

### Product

| Sales Tax Field | Source | Source Field | Notes |
|-----------------|--------|--------------|-------|
| `ID` | Generated | - | UUID generated by Commenda |
| `Name` | RootFi Unified API | `name` | Direct mapping from `PaymentItemWebhookData.name` |
| `TaxCode` | Not Mapped | - | **Hardcoded to empty string `""`** - must be configured manually in Commenda |
| `Sku` | Not Mapped | - | **Hardcoded to empty string `""`** - Stripe products don't have SKU in RootFi mapping |
| `Description` | RootFi Unified API | `description` | Direct mapping from `PaymentItemWebhookData.description` |
| `SourcePlatformID` | RootFi Unified API | `platform_id` | Stripe product ID (e.g., `prod_xxx`) |
| `SourcePlatform` | Constant | - | Set to `STRIPE` |
| `CorporationId` | Context | - | From integration connection |
| `WeightInKg` | Not Mapped | - | Not available from Stripe |
| `VolumeInLiters` | Not Mapped | - | Not available from Stripe |

<Warning>
**SKU and TaxCode are not available from Stripe.** The Stripe transformer in `stripe.transformer.ts` explicitly sets these to empty strings:
```typescript
SKU: "",
"Product Taxability Code": "",
```
If you need SKU or tax codes for products, they must be manually configured in Commenda after sync.
</Warning>

---

### Transaction (Invoice/Credit Note)

| Sales Tax Field | Source | Source Field | Notes |
|-----------------|--------|--------------|-------|
| `ID` | Generated | - | UUID generated by Commenda |
| `CorporationId` | Context | - | From integration connection |
| `TransactedAt` | RootFi Unified API | `posted_date` | ISO date string, falls back to `created_at` if not available |
| `InvoiceCurrency` | RootFi Unified API | `currency_id` | ISO currency code (e.g., `USD`) |
| `Subtotal` | RootFi Unified API | `sub_total` | Already converted to dollars by RootFi |
| `Discount` | RootFi Unified API | `total_discount` | Already converted to dollars by RootFi |
| `ShippingAndHandling` | RootFi Unified API | `shipping_amount` | Already converted to dollars by RootFi |
| `Total` | RootFi Unified API | `total_amount` | Already converted to dollars by RootFi |
| `TaxCollected` | RootFi Unified API | `tax_amount` | Already converted to dollars by RootFi |
| `TransactionType` | Derived | - | `SALE` for invoices, `REFUND` for credit notes |
| `TransactionStatus` | RootFi Unified API | `status` | `VOID` → `VOIDED`, otherwise empty |
| `SourcePlatform` | Constant | - | Set to `STRIPE` |
| `SourcePlatformID` | RootFi Unified API | `platform_id` | Stripe invoice ID (e.g., `in_xxx`) |
| `InvoiceNumber` | RootFi Unified API | `document_number` | Direct mapping |
| `CustomerId` | Resolved | `contact_id` | Resolved by `source_platform_id` lookup in Commenda |
| `ExemptionType` | Not Mapped | - | Set to empty string `""` |

#### Transaction address fields

| Sales Tax Field | Source | Source Field | Notes |
|-----------------|--------|--------------|-------|
| `Ship To Address Line 1` | **Stripe RawData** | `raw_data.shipping.address.line1` or `raw_data.line1` | Parsed from address via `sync.address_parser.ts` |
| `Ship To Address Line 2` | **Stripe RawData** | `raw_data.shipping.address.line2` or `raw_data.line2` | Parsed from address |
| `Ship To Address Line 3` | Not Mapped | - | Set to empty string `""` |
| `Ship To City` | **Stripe RawData** | `raw_data.shipping.address.city` or `raw_data.city` | Parsed from address |
| `Ship To State` | **Stripe RawData** | `raw_data.shipping.address.state` or `raw_data.state` | Parsed from address |
| `Ship To Postal Code` | **Stripe RawData** | `raw_data.shipping.address.postal_code` or `raw_data.postal_code` | Parsed from address |
| `Ship To Country` | **Stripe RawData** | `raw_data.shipping.address.country` or `raw_data.country` | Parsed from address |
| `Ship From Address Line 1` | Not Mapped | - | Set to empty string `""` |
| `Ship From City` | Not Mapped | - | Set to empty string `""` |
| `Ship From State` | Not Mapped | - | Set to empty string `""` |
| `Ship From Postal Code` | Not Mapped | - | Set to empty string `""` |
| `Ship From Country` | Not Mapped | - | Set to empty string `""` |

---

### Line Item

| Sales Tax Field | Source | Source Field | Notes |
|-----------------|--------|--------------|-------|
| `ID` | Generated | - | UUID generated by Commenda |
| `Amount` | RootFi Unified API | `sub_total` | Absolute value, already converted to dollars |
| `Quantity` | RootFi Unified API | `quantity` | Absolute value, defaults to 1 if null |
| `PricePerUnit` | RootFi Unified API | `unit_amount` | Absolute value, or calculated as `sub_total / quantity` |
| `Discount` | RootFi Unified API | `total_discount` | Mapped to `discount_amount_for_line` |
| `Shipping` | Derived | - | Set to 0 for regular items; shipping handled as separate line item |
| `TaxCollected` | RootFi Unified API | `tax_amount` | Direct mapping |
| `TaxCode` | Not Mapped / Special | - | Empty string `""` except for shipping items which use `SRV_Shipping` |
| `ProductId` | Resolved | `item_id` | Resolved by `source_platform_id` lookup in Commenda |
| `ProductSku` | Not Mapped | - | **Hardcoded to empty string `""`** |
| `ExemptionType` | Not Mapped | - | Set to empty string `""` |
| `ExemptionCertificateID` | Not Mapped | - | Set to empty string `""` |
| `TaxIncluded` | Configuration | - | Based on `TAX_INCLUDED_IN_PRICE` config setting |
| `LineNumber` | RootFi Unified API | `line_number` | Direct mapping |

#### Shipping line item

When an invoice has a `shipping_amount > 0`, a synthetic shipping line item is created:

| Sales Tax Field | Value | Notes |
|-----------------|-------|-------|
| `item_id` | `SHIPPING_ITEM_ID` | Synthetic ID for shipping |
| `TaxCode` | `SRV_Shipping` | Special tax code for shipping services |
| `Quantity` | `1` | Always 1 |
| `PricePerUnit` | `shipping_amount` | From invoice's shipping amount |
| `LineNumber` | `9999` or last | Appended after all other line items |

---

## Summary: Fields by source

### Fields from Stripe RawData (via RootFi `raw_data`)

These fields bypass RootFi's normalized fields and read directly from Stripe's original data structure:

| Entity | Field | RawData Path |
|--------|-------|--------------|
| Customer | Shipping Address Line 1 | `raw_data.shipping.address.line1` or `raw_data.line1` |
| Customer | Shipping Address Line 2 | `raw_data.shipping.address.line2` or `raw_data.line2` |
| Customer | Shipping City | `raw_data.shipping.address.city` or `raw_data.city` |
| Customer | Shipping State | `raw_data.shipping.address.state` or `raw_data.state` |
| Customer | Shipping Postal Code | `raw_data.shipping.address.postal_code` or `raw_data.postal_code` |
| Customer | Shipping Country | `raw_data.shipping.address.country` or `raw_data.country` |
| Transaction | Ship To Address Line 1 | `raw_data.shipping.address.line1` or `raw_data.line1` |
| Transaction | Ship To Address Line 2 | `raw_data.shipping.address.line2` or `raw_data.line2` |
| Transaction | Ship To City | `raw_data.shipping.address.city` or `raw_data.city` |
| Transaction | Ship To State | `raw_data.shipping.address.state` or `raw_data.state` |
| Transaction | Ship To Postal Code | `raw_data.shipping.address.postal_code` or `raw_data.postal_code` |
| Transaction | Ship To Country | `raw_data.shipping.address.country` or `raw_data.country` |

### Fields from RootFi Unified API

| Entity | Field | RootFi Field |
|--------|-------|--------------|
| Customer | Name | `name` |
| Customer | Email | `external_links` (type=EMAIL) |
| Customer | Phone | `phone_numbers` |
| Customer | Source Platform ID | `platform_id` |
| Product | Name | `name` |
| Product | Description | `description` |
| Product | Source Platform ID | `platform_id` |
| Transaction | Transaction Date | `posted_date` or `created_at` |
| Transaction | Currency | `currency_id` |
| Transaction | Subtotal | `sub_total` |
| Transaction | Discount | `total_discount` |
| Transaction | Shipping Amount | `shipping_amount` |
| Transaction | Total | `total_amount` |
| Transaction | Tax Amount | `tax_amount` |
| Transaction | Invoice Number | `document_number` |
| Transaction | Source Platform ID | `platform_id` |
| Transaction | Customer ID | `contact_id` |
| Transaction | Status | `status` |
| Line Item | Amount | `sub_total` |
| Line Item | Quantity | `quantity` |
| Line Item | Unit Amount | `unit_amount` |
| Line Item | Discount | `total_discount` |
| Line Item | Tax Amount | `tax_amount` |
| Line Item | Product ID | `item_id` |
| Line Item | Line Number | `line_number` |

### Fields NOT mapped from Stripe

| Entity | Field | Value | Notes |
|--------|-------|-------|-------|
| Product | SKU | `""` | Stripe products don't have SKU |
| Product | TaxCode | `""` | Must be configured manually |
| Line Item | Product SKU | `""` | Not available from Stripe |
| Line Item | Product Taxability Code | `""` | Empty except shipping items (`SRV_Shipping`) |
| Transaction | Ship From Address | `""` | Not mapped from Stripe |
| Customer | Billing Address | `""` | Not mapped (only shipping is used) |

---

## Code references

### Address parsing (`sync.address_parser.ts`)

```typescript
if (integration === RootFiIntegration.STRIPE) {
  const rawAddress = addressData?.raw_data?.shipping?.address 
                     ?? addressData?.raw_data;
  return (
    (rawAddress?.line1 ? rawAddress?.line1 + ", " : "") +
    (rawAddress?.city ? rawAddress?.city + ", " : "") +
    (rawAddress?.state ? rawAddress?.state + ", " : "") +
    (rawAddress?.postal_code ? rawAddress?.postal_code + ", " : "") +
    (rawAddress?.country ? rawAddress?.country + ", " : "")
  );
}
```

### Product mapping (`stripe.transformer.ts`)

```typescript
getProductMapper(): (product: PaymentItemWebhookData) => any {
  return (product: PaymentItemWebhookData): BulkUploadProductTemplate => ({
    "Product Name": product.name,
    SKU: "",  // Not mapped from Stripe
    "Product Taxability Code": "",  // Not mapped from Stripe
    "Product Description": product.description,
    "Source Platform ID": product.platform_id,
    "Source Platform": RootFiIntegration.STRIPE,
  });
}
```

### Customer mapping (`stripe.transformer.ts`)

```typescript
getContactMapper(): (contact: PaymentCustomerWebhookData) => any {
  return (customer: PaymentCustomerWebhookData): BulkUploadContactTemplate => {
    const phoneNumber = this.getCustomerNumber(customer?.phone_numbers);
    const email = this.getCustomerEmail(customer?.external_links);

    return {
      "Customer Name": customer.name,
      "Customer Contact Name": customer.name,
      "Customer Contact Email": email,
      "Customer Contact Phone": phoneNumber,
      // Billing addresses not mapped
      "Billing Address line 1": "",
      "Billing City": "",
      // Shipping from parsed address (raw_data)
      "Shipping Address line 1": this._address?.address_line1 ?? "",
      "Shipping City": this._address?.city ?? "",
      "Shipping Postal Code": this._address?.zip_code ?? "",
      "Shipping State Code": this._address?.state ?? "",
      "Shipping Country Code": this._address?.country ?? "",
      "Source Platform": RootFiIntegration.STRIPE,
      "Source Platform ID": customer.platform_id,
    };
  };
}
```

### Invoice/Line Item mapping (`stripe.transformer.ts`)

```typescript
getInvoiceMapper(dataModel: RootfiSyncDatamodels) {
  const isRefund = dataModel === RootfiSyncDatamodels.PAYMENT_CREDIT_NOTES;

  return (lineItem: PaymentInvoicelineItemWebhookData) => {
    const isShippingItem = lineItem.item_id === "SHIPPING_ITEM_ID";
    
    return {
      "Transaction Type": isRefund ? "REFUND" : "SALE",
      "Transaction Date (YYYY-MM-DD)": this._voucher?.posted_date?.slice(0, 10) 
                                       || this._voucher?.created_at?.slice(0, 10),
      "Price Per Unit": Math.abs(lineItem.unit_amount) 
                        || lineItem.sub_total / lineItem.quantity,
      Quantity: Math.abs(lineItem?.quantity) || 1,
      Discount: lineItem?.discount_amount_for_line ?? 0,
      "Item Tax": lineItem?.tax_amount ?? 0,
      "Product SKU": "",  // Not mapped
      "Product Taxability Code": isShippingItem ? "SRV_Shipping" : "",
      "Source Platform": RootFiIntegration.STRIPE,
      "Source Platform ID": this._voucher?.platform_id,
      "Invoice Number": this._voucher?.document_number,
      "Currency Code": this._voucher?.currency_id,
      // Ship To from parsed address (raw_data)
      "Ship To Address Line 1": this._address?.address_line1 ?? "",
      "Ship To City": this._address?.city ?? "",
      "Ship To State Code": this._address?.state ?? "",
      "Ship To Postal Code": this._address?.zip_code ?? "",
      "Ship To Country Code": this._address?.country ?? "",
      // Ship From not mapped
      "Ship From Address Line 1": "",
      "Customer Source Platform ID": this._voucher?.contact_id,
      "Product Source Platform ID": lineItem?.item_id,
    };
  };
}
```
